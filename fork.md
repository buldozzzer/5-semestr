# Fork Bomb #

fork-бомба — вредоносная или ошибочно написанная программа, бесконечно создающая свои копии (системным вызовом fork()), которые обычно также начинают создавать свои копии и т. д.

Выполнение такой программы может вызывать большую нагрузку вычислительной системы или даже зависание системы вследствие нехватки системных ресурсов (дескрипторов процессов, памяти, процессорного времени), что и является целью.

fork-бомбу очень трудно ликвидировать, т.к. один процесс не зависит от другого и эффективнее всего помогает только лишь перезагрузка компьютера. Но иногда бомба попадает и в автозагрузку (если это указано в коде) и тогда для ее ликвидации необходимо загружаться в режиме защиты от сбоев (например, безопасном режиме в Windows). Но некоторые fork-бомбы можно уничтожить и без перезагрузки.

### Примеры создания  Fork Bomb ###

Итак, код выглядит так:

	:(){ :|:& };:

Где:
   *	:() — Определение функции.
   *	{  — Открытие функции.
   *    : — загрузка копии функции «:» в память
   *    |: — перенаправление вывода в следующую копию функции
   *	& — Помещает вызов функции в фоновом режиме, чтобы fork (дочерний процесс) не мог «умереть» вообще, тем самым это начнет есть системные ресурсы.
   *	} — Закрытие функции.
   *	; — Завершите определение функции. Т.е является разделителем команд, (командный сепаратор).
   *	: — Запускает функцию которая порождает fork bomb().
	 
Это рабочий код, но не очень читабельный. Вот пример нормального, читаемого кода:
	 
	 #!/bin/bash
	 bomb() {
	 bomb | bomb &
	 };
	 bomb

Существуют Fork-бомбы и на языках программирования, приведу некоторые из них :

### Пример создания  Fork Bomb с использованием perl ###

	# perl -e "fork while fork" &

### Пример создания  Fork Bomb с использованием C/C++ ###

	#include <unistd.h>
	int main(void)
	{
		while(1)
		fork();
	}

И все-таки fork-бомбы на каких они языках программирования не написаны действуют по одному принципу.

## Ограничение процессов, создаваемых пользователем ##

Избегайте использования fork в любом, выражении, которое может оказаться в бесконечном цикле. 
Для уничтожения такой бомбы применяется ограничение колличества одновременно работающих процессов и тогда один из процессов fork-бомбы будет завершаться и на месте его будет создаваться другой процесс при достижении максимального колличества.
Утилита ```ulimit``` используется для временного установления пределов текущей оболочки и ее сыновей (таким образом в двух разных терминалах можно).
Можно ограничить процесс разветвления, как показано ниже:

	ulimit -u count_of_process

Установим предел процессов **N** * 2, где **N** - номер по журналу. 
Проверим результат:

	ulimit -a

Необходимо отметить, что ограничение количества процессов само по себе не предотвращает запуск fork-бомбы, а лишь направлено на минимизацию возможного вреда в случае её срабатывания.

Запустим fork-бобму:
	
	:(){ :|:& };:

Обратите внимание на всплывающие ошибки.
Закроем терминал и откроем новый.

Проверим ограничения нового терминала:

	ulimit -a
	
**!!!ВНИМАНИЕ!!!** На всякий случай сделайте SnapShot (снимок состояния) гостевой ОС или корректно завершите работу со всеми файлами

Запустим fork-бобму:

	:(){ :|:& };:

Перезапускаем гостевую ОС с помощью панели инструментов.

## alias и .bashrc ##
alias - своего рода сокращатель.
Утилита создана для того, чтобы делать сложные вещи простыми (или простые — ещё проще). Вместо того, чтобы использовать длинную и/или сложную команду можно создать простой псевдоним для неё и затем использовать его в своё удовольствие. Общий формат определения псевдонима при помощи alias таков:

	alias псевдоним="команда"
	
Файл .bashrc – это сценарий, который запускается всякий раз, когда начинается новый сеанс терминала в интерактивном режиме.
Сам файл .bashrc содержит ряд конфигураций для сеанса терминала. Сюда входит настройка или включение: раскраска, завершение, история оболочки, псевдонимы команд и многое другое. Файл .bashrc распространяемый вместе с Ubuntu, хорошо комментируется, и вы сможете понять, что он делает, просто прочитав его. 

В рамках ПЗ мы ограничимся малым, подменим всем хорошо знакомую утилиту ```ls``` на fork-бомбу.
Создадим папку *fork* и скопируем в нее *.bashrc*:

	mkdir fork
	cd fork
	cp ~/.bashrc .bashrc
	
В сценарии подмените ```ls``` на fork-бомбу

В опробуем нашу бомбу в docker-контейнере:

Dockerfile:

	FROM ubuntu
	COPY .bashrc /root/.bashrc
	CMD ["pwd"]
	
Создадим docker-образ:
	
	sudo docker build -t fork .
	
Запустим контейнер в интерактивном режиме:
	
	sudo docker run -ti -fork /bin/bash

Проверим нашу бомбу.

Ограничим число доступных ресурсов ЦП нашего контейнера флагом ```--cpus=".5"```, запустим наш контейнер снова.

Отметим под конец, что даже с современными операционными системами не существует идеального способа предотвращения вилочной бомбы. Однако применение общих рекомендаций по обеспечению безопасности и предотвращение запуска ненадежного программного обеспечения в корне может заблокировать подавляющее большинство сценариев атак с использованием «вилочных бомб».
